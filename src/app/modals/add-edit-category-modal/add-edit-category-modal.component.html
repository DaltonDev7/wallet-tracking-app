@if (open) {
  <div class="fixed inset-0 z-40 flex items-center justify-center bg-slate-900/40 px-4">
    <div class="w-full max-w-md rounded-2xl bg-white p-5 shadow-xl">
      <!-- Header -->
      <div class="mb-4 flex items-start justify-between">
        <div>
          <h2 class="text-lg font-semibold text-slate-900">
            {{ mode === 'create' ? 'Nueva categoría' : 'Editar categoría' }}
          </h2>
          <p class="mt-1 text-xs text-slate-500">
            Define un nombre, tipo y color para esta categoría.
          </p>
        </div>
        <button
          type="button"
          (click)="handleClose()"
          class="inline-flex h-7 w-7 items-center justify-center rounded-full
                 bg-slate-100 text-xs text-slate-500 hover:bg-slate-200"
          aria-label="Cerrar"
        >
          ✕
        </button>
      </div>

      <form [formGroup]="form" (ngSubmit)="handleSubmit()" class="space-y-4">
        <!-- Nombre -->
        <div>
          <label class="mb-1 block text-xs font-medium text-slate-600">
            Nombre de la categoría
          </label>
          <input
            type="text"
            formControlName="name"
            class="w-full rounded-lg border border-slate-200 px-3 py-2 text-sm
                   outline-none ring-1 ring-transparent focus:border-slate-900 focus:ring-slate-900/5"
            placeholder="Ej: Comida, Transporte, Renta..."
          />
          @if (form.get('name')?.invalid && form.get('name')?.touched) {
            <p class="mt-1 text-[11px] text-red-500">
              Ingresa un nombre válido (máx. 30 caracteres).
            </p>
          }
        </div>

        <!-- Tipo -->
        <div>
          <label class="mb-1 block text-xs font-medium text-slate-600">
            Tipo
          </label>
          <div class="inline-flex rounded-full border border-slate-200 bg-slate-50 p-1 text-xs">
            @for (opt of typeOptions; track opt.value) {
              <button
                type="button"
                (click)="form.get('type')?.setValue(opt.value)"
                class="rounded-full px-3 py-1 transition font-medium"
                [ngClass]="{
                  'bg-red-100 text-red-600 shadow-sm':
                    form.get('type')?.value === 'expense' && opt.value === 'expense',
                  'bg-emerald-100 text-emerald-600 shadow-sm':
                    form.get('type')?.value === 'income' && opt.value === 'income',
                  'text-slate-500':
                    form.get('type')?.value !== opt.value
                }"
              >
                {{ opt.label }}
              </button>
            }
          </div>
        </div>

        <!-- Acciones -->
        <div class="mt-3 flex items-center justify-end gap-2 pt-2">
          <button
            type="button"
            (click)="handleClose()"
            class="rounded-lg px-3 py-2 text-xs font-medium text-slate-500 hover:bg-slate-100"
          >
            Cancelar
          </button>
          <button
            type="submit"
            [disabled]="form.invalid"
            class="rounded-lg bg-slate-900 px-4 py-2 text-xs font-medium text-white
                   shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed
                   disabled:bg-slate-300 disabled:text-slate-600"
          >
            {{ mode === 'create' ? 'Guardar categoría' : 'Guardar cambios' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}
